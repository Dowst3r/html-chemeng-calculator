<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="keywords" content="HTML, CSS" />
    <link rel="icon" href="images/Thermometer1.png" type="image/png">
    <title>Dew Temperature iteration loop</title>
    <style>
      .Second-A-Value {
        padding-top: 50px;
      }

      em {
        font-weight: bold;
      }

      .Dew-Antoine-Equation {
        width: 400px;
        position: absolute;
        top: 75px;
        right: 800px;
      }

      .Dew-pressure {
        padding-top: 50px;
      }

      .Vapour-moles {
        padding-top: 15px;
      }
      .Calculate-Button {
        padding-top: 15px;
      }

      .Num-Iterations {
        padding-top: 15px;
      }

      #graphContainer {
        width: 70%;
        height: 400px;
      }

      canvas {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <h1>Dew Temperature Iteration Loop Calculator:</h1>
    <img
      class="Dew-Antoine-Equation"
      src="images/Antoine-Equation-Real.PNG"
      alt="Image failed to load"
    />
    <p>The <em>A</em> value for the <em>first</em> Antoine Equation:</p>
    <input type="text" id="A1-Dew" name="textbox" />
    <p>The <em>B</em> value for the <em>first</em> Antoine Equation:</p>
    <input type="text" id="B1-Dew" name="textbox" />
    <p>the <em>C</em> value for the <em>first</em> Antoine Equation:</p>
    <input type="text" id="C1-Dew" name="textbox" />
    <p class="Second-A-Value">
      The <em>A</em> value for the <em>second</em> Antoine Equation:
    </p>
    <input type="text" id="A2-Dew" name="textbox" />
    <p>The <em>B</em> value for the <em>second</em> Antoine Equation:</p>
    <input type="text" id="B2-Dew" name="textbox" />
    <p>the <em>C</em> value for the <em>second</em> Antoine Equation:</p>
    <input type="text" id="C2-Dew" name="textbox" />
    <p class="Dew-pressure">The <em>pressure</em> of the system:</p>
    <input type="text" id="Pressure-Dew-System" name="textbox" />
    <p class="Vapour-moles">
      The <em>mole fractions</em> in the <em>vapour</em> phase <em>(y1)</em>:
    </p>
    <input type="text" id="Vapour-Dew-Moles" name="textbox" />
    <p class="Num-Iterations">
      The <em>Maximum</em> amount of <em>Iterations</em> to go through:
    </p>
    <input type="text" id="Max-Iterations_Dew" name="textbox" />
    <p>
      the <em>Unit</em> of the Temperature (don't need to type degrees, just the
      letter unit):
    </p>
    <input type="text" id="Unit-Dew" name="textbox" />
    <p class="Calculate-Button"></p>
    <button type="button" onclick="calculate()">Calculate</button>
    <div class="Result-Container">
      <p id="Text_Result_Dew"></p>
    </div>
    <div id="graphContainer">
      <canvas id="Graph_Dew"></canvas>
    </div>
    <script>
      var graph = null;

      function calculate() {
        let Temperature_Dew = [];
        let T_values_Dew = [];
        let T_new_Dew_Array = [];
        let A_Dew = [];
        let B_Dew = [];
        let C_Dew = [];

        A_Dew.splice(0, A_Dew.length);
        B_Dew.splice(0, B_Dew.length);
        C_Dew.splice(0, C_Dew.length);
        Temperature_Dew.splice(0, Temperature_Dew.length);
        T_values_Dew.splice(0, T_values_Dew.length);
        T_new_Dew_Array.splice(0, T_new_Dew_Array.length);

        var A1_Dew = parseFloat(document.getElementById("A1-Dew").value);
        var B1_Dew = parseFloat(document.getElementById("B1-Dew").value);
        var C1_Dew = parseFloat(document.getElementById("C1-Dew").value);
        var A2_Dew = parseFloat(document.getElementById("A2-Dew").value);
        var B2_Dew = parseFloat(document.getElementById("B2-Dew").value);
        var C2_Dew = parseFloat(document.getElementById("C2-Dew").value);
        let Unit_Dew = document.getElementById("Unit-Dew").value;
        var Pres_Dew = parseFloat(document.getElementById("Pressure-Dew-System").value);
        var y1_Dew = parseFloat(document.getElementById("Vapour-Dew-Moles").value);
        var Max_Iterations_Dew = parseFloat(document.getElementById("Max-Iterations_Dew").value);

        A_Dew = [A1_Dew, A2_Dew];
        B_Dew = [B1_Dew, B2_Dew];
        C_Dew = [C1_Dew, C2_Dew];

        var iteration_Dew = 0;
        keep_looping_Dew = true;
        var total_Dew = 0;
        var avg_Dew = 0;

        if (
          isNaN(A1_Dew) ||
          isNaN(A2_Dew) ||
          isNaN(B1_Dew) ||
          isNaN(B2_Dew) ||
          isNaN(C1_Dew) ||
          isNaN(C2_Dew) ||
          isNaN(Pres_Dew) ||
          isNaN(y1_Dew) ||
          isNaN(Max_Iterations_Dew)
        ) {
          document.getElementById("Text_Result_Dew").innerHTML =
            "Please enter valid numbers";
        } else {
          var y2_Dew = 1 - y1_Dew;
          for (var i = 0; i < 2; i++) {
            var T_Dew = B_Dew[i] / (A_Dew[i] - Math.log(Pres_Dew)) - C_Dew[i];
            var total_Dew = total_Dew + T_Dew;
            Temperature_Dew.push(T_Dew);
          }
          var sum = Temperature_Dew[0] + Temperature_Dew[1];
          var avg_Dew = sum / 2;

          while (keep_looping_Dew) {
            var p1_Dew = Math.exp(A_Dew[0] - B_Dew[0] / (avg_Dew + C_Dew[0]));
            var p2_Dew = Math.exp(A_Dew[1] - B_Dew[1] / (avg_Dew + C_Dew[1]));
            var alpha_Dew = p1_Dew / p2_Dew;
            var p1_new_Dew = Pres_Dew * (y1_Dew + y2_Dew * alpha_Dew);
            var T_new_Dew = B_Dew[0] / (A_Dew[0] - Math.log(p1_new_Dew)) - C_Dew[0];
            T_values_Dew.push(T_new_Dew);
            var avg_Dew = T_new_Dew;

            if (iteration_Dew < Max_Iterations_Dew) {
              iteration_Dew++;
              T_new_Dew_Array.push(T_new_Dew);
            } else {
              keep_looping_Dew = false;
              var x1_Dew = (y1_Dew * Pres_Dew) / p1_Dew;
              var x2_Dew = 1 - x1_Dew;
            }
          }

          var output_Dew =
            "The graph converges to a temperature of " +
            T_values_Dew[T_values_Dew.length - 1] +
            " degrees " +
            Unit_Dew +
            " after " +
            iteration_Dew +
            " loops\n" +
            "the difference between the 2 final temperature values: " +
            Math.abs(
              T_values_Dew[T_values_Dew.length - 2] -
                T_values_Dew[T_values_Dew.length - 1]
            ) + " degrees " + Unit_Dew + 
            "\nthe liquid phase composition: x1 = " +
            x1_Dew +
            " and x2 = " +
            x2_Dew;

          const x_axis = Array.from(
            { length: T_values_Dew.length },
            (_, i) => i + 1
          );
          const ctx = document.getElementById("Graph_Dew").getContext("2d");
          if (graph) {
            graph.clear();
            graph.destroy();
          }
          graph = new Chart(ctx, {
            type: "line",
            data: { 
              labels: x_axis, 
              datasets: [{ 
              label: "Temperature in degrees\n" + Unit_Dew,
              data: T_values_Dew, 
              backgroundColor: [
                "rgba(255, 192, 203, 1)"
              ],
              borderColor: "#FFC0CB" }] },
            options: {
              plugins: {
                title: {
                  display: true,
                  text: "Temperature values through the iteration loops",
                },
              },
              legend: {
              display: false,
              position: "bottom",
              name: "Temperatures",
              text: "Temperature Chart",
            },
            },
          });
          document.getElementById("Text_Result_Dew").innerHTML = output_Dew;
          document.getElementById("Graph_Dew").innerHTML = graph
        }
      }
    </script>
  </body>
</html>
